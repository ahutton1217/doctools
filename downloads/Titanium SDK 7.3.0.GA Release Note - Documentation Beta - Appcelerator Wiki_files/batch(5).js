;try {
/* module-key = 'com.metainf.confluence.plugin.pagetreeexporter.pagetree-word-exporter-plugin:content-exporter-web-resource', location = 'js/content-exporter.js' */
$(function(){AJS.CONTENT_EXPORTER={init:function(a){this.options=a;this.guiTemplateNode=AJS.$("#content-exporter-gui-template");if(!this.options.lastExport){this.initExportDialog();this.initExportProgressDialog();this.exportDialog.getPanel(0).select();this.exportDialog.show()}else{if(this.options.licensed){this.initExportProgressDialog();AJS.CONTENT_EXPORTER.doExport(this.options.params)}}if(!this.options.licensed){var b=this.options.lastExport;this.showError("Sorry, Content Exporter's license is unavailable or expired, export is not allowed!<br/><a href="+this.options.urls.upmUrl+" target='_blank'>Click here</a> to manage the add-on's license in Confluence's Plugin Manager.",b)}},initError:function(a){this.options=a;this.guiTemplateNode=AJS.$("#content-exporter-gui-template")},initExportProgressDialog:function(){if(this.exportProgressDialog){return}this.exportProgressDialog=new AJS.Dialog({width:400,height:200,id:"export-progress-dialog",closeOnOutsideClick:false,keypressListener:$.proxy(function(a){if(a.keyCode==27){this.closeAll(this)}},this)});this.exportProgressDialogNode=AJS.$("#"+this.exportProgressDialog.id);this.exportProgressDialog.addHeader("Export in progress");this.exportProgressDialogNode.find(".dialog-title").prepend(this.guiTemplateNode.find(".content-exporter-header-avatar").clone());this.exportProgressDialog.addLink("Cancel",$.proxy(function(a){this.closeAll(a)},this),"#");this.exportProgressDialog.addPanel("",this.guiTemplateNode.find("#content-exporter-progress-dialog"),"panel-body")},initExportDialog:function(){var a=this;this.exportDialog=new AJS.Dialog({width:Math.min(this.options.width,1300),height:Math.min(this.options.height,700),id:"export-dialog",closeOnOutsideClick:false,keypressListener:$.proxy(function(b){if(b.keyCode==27){this.closeAll(this)}},this)});this.exportDialogNode=AJS.$("#"+this.exportDialog.id);this.exportDialog.addHeader("Export content");this.exportDialogNode.find(".dialog-title").prepend(this.guiTemplateNode.find(".content-exporter-header-avatar").clone());this.exportDialog.addButton("Export",$.proxy(function(b){var c=this.exportDialogNode.find(".content-exporter-content-form");c.find("input[name=exportFormat]").val(this.exportDialogNode.find("input.output-format:checked").val());c.find("input[name=coverPage]").val(this.exportDialogNode.find("#cover-page-checkbox").attr("checked")?"true":"false");this.doExport(c.serializeArray())},this),"content-exporter-export-button");this.exportDialog.addLink("Cancel",$.proxy(function(b){this.closeAll(b)},this),"#");this.exportDialogNode.find(".dialog-button-panel").prepend(AJS.$('<span id="content-exporter-summary"></span>'));this.exportDialog.addPanel("Content",this.guiTemplateNode.find(".content-exporter-content-form"),"panel-body");this.exportDialog.addPanel("Output Format",this.guiTemplateNode.find(".content-exporter-output-form"),"panel-body");this.exportDialog.addPanel("Cover Page",this.guiTemplateNode.find(".content-exporter-cover-form"),"panel-body");this.exportDialogNode.find("#export-type-select").change($.proxy(function(d){var b=(AJS.$(d.target).val()=="PAGE");var c=this.exportDialogNode.find(".content-exporter-content-form");if(b){c.find("#filter-label-container").hide();c.find("#tree-container").hide();c.find("#root-container").show()}else{c.find("#filter-label-container").show();c.find("#tree-container").show();c.find("#root-container").hide()}},this));this.exportDialogNode.find("#export-type-select, #tree-container input.checkbox").change($.proxy(function(b){this.updateExportButton()},this));this.exportDialogNode.find("#export-type-select, input.output-format, #cover-page-checkbox").change($.proxy(function(b){this.updateSummary()},this));this.exportDialogNode.find("#tree-container input.checkbox").click($.proxy(function(f){var d=AJS.$(f.target);var b=d.attr("data-page-id");var c=d.attr("checked");this.exportDialogNode.find("#container"+b+" input[type=checkbox]").attr("checked",c?true:false);this.updateExportButton()},this));this.exportDialogNode.find("#label-filter-input").keypress($.proxy(function(b){if(b.keyCode==13){this.applyLabelFilter();b.preventDefault()}},this));this.exportDialogNode.find("#apply-label-filter-button").click($.proxy(function(b){this.applyLabelFilter();b.preventDefault()},this));this.exportDialogNode.find("#clear-label-filter-button").click($.proxy(function(d){var b=this.exportDialogNode.find("#label-filter-input");var c=this.exportDialogNode.find("#tree-container");b.val("");c.find("input[type=checkbox]").prop("checked",true);this.updateExportButton();d.preventDefault()},this));this.updateSummary();this.updateExportButton()},applyLabelFilter:function(){var b=this.exportDialogNode.find("#label-filter-input");var c=this.exportDialogNode.find("#tree-container");var a=this;if(b.val()>""){AJS.log("Doing label filter: "+b.val());AJS.$("#label-filter-spinner").show();AJS.$.ajax({url:this.options.urls.labelFilterUrl,data:AJS.$.extend({},this.options.params,{labels:b.val()}),type:"POST",cache:false,dataType:"json",success:function(e){AJS.log("FILTERED: "+e);c.find("input[type=checkbox]").prop("checked",false);for(i=0;i<e.length;i++){var d=e[i];c.find("input[value="+d+"]").prop("checked",true)}a.updateExportButton()},error:function(d,f,e){a.showError(a.createErrorMessage("Sorry, filtering by label failed!",d));AJS.log("Label filtering error: "+f+", "+e)},complete:function(){AJS.$("#label-filter-spinner").hide()}})}},updateExportButton:function(){var a=false;if(this.options.licensed){if(this.exportDialogNode.find("#export-type-select").val()=="PAGE"){a=true}else{a=this.exportDialogNode.find("#tree-container input.checkbox:checked:enabled").length>0}}this.exportDialogNode.find(".content-exporter-export-button").prop("disabled",!a)},updateSummary:function(){var a="Output: <b>"+this.exportDialogNode.find("input.output-format:checked").val().toUpperCase()+"</b> | Cover page: <b>"+(this.exportDialogNode.find("#cover-page-checkbox").prop("checked")?"Yes":"No")+"</b> | Content: <b>"+this.exportDialogNode.find("#export-type-select option:selected").text()+"</b>";this.exportDialogNode.find("#content-exporter-summary").html(a)},poll:function(){AJS.log("Polling for export");var a=this;AJS.$.ajax({url:this.options.urls.pollUrl,type:"GET",data:this.options.params,dataType:"json",cache:false,success:function(b){if(b.ready){a.download()}else{setTimeout(function(){a.poll()},1000)}},error:function(b,d,c){a.exportProgressDialog.hide();a.showError(a.createErrorMessage("Sorry, can not check export state, download is unavailable!",b),true);AJS.log("Poll error: "+d+", "+c)}})},doExport:function(a){AJS.log("doExport called");var b=this;if(this.exportDialog){this.exportDialog.hide()}this.exportProgressDialog.show();AJS.$.ajax({url:this.options.urls.exportUrl,type:"POST",timeout:180000,data:a,cache:false,dataType:"json",success:function(c){AJS.log("Hash: "+c.hash);b.options.params.hash=c.hash;b.poll()},error:function(c,e,d){b.exportProgressDialog.hide();b.showError(b.createErrorMessage("Sorry, can not start export!",c),true);AJS.log("Start export error: "+e+", "+d)}})},download:function(){AJS.log("Downloading file: "+this.options.params.hash);var a=this.options.urls.downloadUrl;a=a+(a.indexOf("?")>0?"&":"?")+AJS.$.param(this.options.params);if(this.iframe&&this.iframe.length>0){this.iframe.remove()}this.iframe=AJS.$("<iframe>").hide().prop("src",a).appendTo("body");setTimeout(function(){AJS.CONTENT_EXPORTER.checkDownloadStarted()},500)},checkDownloadStarted:function(){AJS.log("check download: "+document.cookie);var a="content-export-"+this.options.params.hash;if(document.cookie.indexOf(a+"=success")>=0){document.cookie=a+"=; path=/; expires="+new Date(0).toUTCString();setTimeout(function(){AJS.CONTENT_EXPORTER.closeAll(AJS.CONTENT_EXPORTER.exportProgressDialog)},100)}else{if(this.checkDownloadFailed()){setTimeout(function(){AJS.CONTENT_EXPORTER.showError("Sorry, download failed! Please contact your administrator!<br/>Error identifier: "+AJS.CONTENT_EXPORTER.options.params.hash,true)},100)}else{setTimeout(function(){AJS.CONTENT_EXPORTER.checkDownloadStarted()},500)}}},checkDownloadFailed:function(){try{var b=this.iframe[0].contentWindow||this.iframe[0].contentDocument;if(b.document){b=b.document}if(b&&b.body!==null&&b.body.innerHTML.length){return true}}catch(a){return true}return false},showError:function(d,b){var c=AJS.$("<div style='position: absolute; visibility: hidden; width: 600px'></div>");c.html(d);c.appendTo("body");var a=c.height();c.remove();this.exportErrorDialog=new AJS.Dialog({width:600,height:a+150,id:"export-error-dialog",closeOnOutsideClick:false,keypressListener:$.proxy(function(f){if(f.keyCode==27){this.closeError();f.preventDefault()}},this)});this.exportErrorDialog.callCloseAll=b;this.exportErrorDialogNode=AJS.$("#"+this.exportErrorDialog.id);this.exportErrorDialog.addHeader("Error");this.exportErrorDialogNode.find(".dialog-title").prepend(this.guiTemplateNode.find(".content-exporter-header-avatar").clone());this.exportErrorDialog.addButton("OK",$.proxy(function(e){this.closeError()},this));this.exportErrorDialog.addPanel("","<p>"+d+"</p>","panel-body");this.exportErrorDialogNode.find(".error-message").html(d);this.exportErrorDialog.show();if(this.exportDialogNode&&this.exportDialogNode.is(":visible")){this.showCustomBlanket()}},createErrorMessage:function(c,a){if(a&&a.responseText>""){var b=JSON.parse(a.responseText);if(b&&b.errorId){c=c+"<br/>Error identifier: "+b.errorId}}return c},showCustomBlanket:function(){var a=this.exportDialogNode.offset();AJS.$(".content-exporter-blanket").css({left:a.left,top:a.top,width:this.exportDialogNode.outerWidth(),height:this.exportDialogNode.outerHeight(),"z-index":this.exportErrorDialogNode.css("z-index")-1})},closeError:function(){this.exportErrorDialog.remove();AJS.$(".content-exporter-blanket").css({width:0,height:0});if(this.exportErrorDialog.callCloseAll){this.closeAll(null)}},closeAll:function(a){if(this.options.onClose){this.options.onClose(a)}},removeAllDialogs:function(){if(this.exportDialog){this.exportDialog.remove();this.exportDialog=null}if(this.exportProgressDialog){this.exportProgressDialog.remove();this.exportProgressDialog=null}}}});
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}

;
;try {
/* module-key = 'com.metainf.confluence.plugin.pagetreeexporter.pagetree-word-exporter-plugin:content-exporter-web-resource', location = 'js/content-exporter-init.js' */
AJS.toInit(function(){AJS.$("#content-exporter-menu, #content-exporter-menu-last").on("click",function(a){AJS.$.ajax({url:AJS.$(this).attr("href")+"&_="+new Date().getTime(),type:"GET",cache:false,dataType:"html",success:function(c){var b=AJS.$("#content-exporter-container");if(b.length>0){b.empty()}else{b=AJS.$("<div id='content-exporter-container'></div>");AJS.$("body").append(b)}b.append(c);initContentExporter()},error:function(b,d,c){alert("Can not initialize Content Exporter!")}});a.preventDefault()})});
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}

;
