# doctools

Tools and scripts to build the Appcelerator Docs site. This  is intended to the be "source of truth" for the contents published to [docs.appcelerator.com](https://docs.appcelerator.com)

## Overall Architecture
 This repository serves as the place where both manual contents and script to generate contents live.

 This repository has multiple inputs:
 - [wiki-export](https://github.com/appcelerator/wiki-export) which provides the exported wiki contents as an input zipfile, which makes up our doc site's "guides" section
 - [Titanium SDK](https://github.com/appcelerator/titanium_mobile), [Titanium Windows SDK](https://github.com/appcelerator/titanium_mobile_windows), [Alloy](https://github.com/appcelerator/alloy), and various [Native Modules](https://github.com/appcelerator-modules) - which we use to grab the apidocs YML files, generate a jsduck compatible JS file and then run through JSDuck to generate HTML.
 - [JSDuck](https://github.com/appcelerator/jsduck/tree/sgtcoolguy) which is used to generate the full platform documentation

## Wiki Exports
There are a series of scripts that can be run to generate a wiki export in a zipfile,
unzip it, copy in redirects, "massage" the HTML, and generate the HTML contents for the 
"guides" section of the [docs.appcelerator.com](https://docs.appcelerator.com) site.

```sh
npm run wiki <username> <password>
# This actually just delegates to the various scripts that do all the steps:
npm run wiki:export -u <username> -p <password>
npm run wiki:unzip
npm run wiki:redirects
npm run wiki:finalize
npm run wiki:guides
```

The actual Jenkins build does not do the export step, but instead grabs the latest export from the [Jenkins job](https://jenkins.appcelerator.org/job/docs/job/wiki-export/job/master/) attached to the [wiki-export repository](https://github.com/appcelerator/wiki-export).

## API docs from SDK/Module/Alloy repositories
We then check out a number of input repositories to produce the API docs from a series of YML files (typically held in a `apidocs` folder of the repository). The script generating JSDuck compatible JS file from the YML lives in [Titanium SDK's repository](https://github.com/appcelerator/titanium_mobile/blob/master/apidoc/docgen.js)

## JSDuck HTML generation from API docs
Once we have the generated titanium.js file we run that through our fork of JSDuck to generate the site from the wiki guides and the APIdocs. We do a separate pass for the Alloy JS files.

The actual template for the generated HTML/CSS/JS lives in the `apidocs/template` folder in this repository. We run a Node.JS script to generate a minified version, compile the scss, install jsduck and execute JSDuck against all of that.

## Generating Release Notes

Release notes may be auto-generated by running `npm run release-notes`.

This is driven by a NodeJS script which expects the wiki steps to have been run, then scans the exported wiki pages for Titanium SDK release note pages. It then does some conversion/massaging of the HTMl and writes the result to the `release-notes` folder (only if no page already exists for that version).

This is intended to be run manually, and the resulting file(s) to be committed to git after manual inspection and modifications

### Single Release
Instead of batch exporting the wiki contents and generating all missing release notes, you can selectively generate a release note html file for a single release - if the wiki has the page already.

```sh
npm run sdk-release-note 8.3.1.GA
```

The above command will export the contents of the wiki page `Titanium SDK 8.3.1.GA Release Note`, manipulate the html, and output `release-notes/8.3.1.GA.html`.

This is intended to be run manually, and the resulting file(s) to be committed to git after manual inspection and modifications (such as formatting the generated HTML). It is also expected that the `landing/index.html` page is manually updated and committed.