<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>Migrating Node.ACS Applications to API Builder</title>

    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <meta content="Scroll EclipseHelp Exporter" name="generator"/>

    <link type="text/css" rel="stylesheet" href="css/eclipse-defaults.css" />
    <link type="text/css" rel="stylesheet" href="css/common.css" />
    <link type="text/css" rel="stylesheet" href="css/print.css" media="print" />
</head>
<body>
    <div class="container">
        <div class="header"></div>

        <div id="src-43298928" class="content">
                        <h1>Migrating Node.ACS Applications to API Builder</h1>
    <p  >    </p>
<ul class="toc-indentation "><li class=" ">    <p  ><a  class="document-link " href="Migrating_Node.ACS_Applications_to_API_Builder.html#src-43298928_MigratingNode.ACSApplicationstoAPIBuilder-Introduction">Introduction</a>    </p>
</li><li class=" ">    <p  ><a  class="document-link " href="Migrating_Node.ACS_Applications_to_API_Builder.html#src-43298928_MigratingNode.ACSApplicationstoAPIBuilder-CreateanAPIBuilderproject">Create an API Builder project</a>    </p>
</li><li class=" ">    <p  ><a  class="document-link " href="Migrating_Node.ACS_Applications_to_API_Builder.html#src-43298928_MigratingNode.ACSApplicationstoAPIBuilder-package.json">package.json</a>    </p>
</li><li class=" ">    <p  ><a  class="document-link " href="Migrating_Node.ACS_Applications_to_API_Builder.html#src-43298928_MigratingNode.ACSApplicationstoAPIBuilder-Expressappinstance">Express app instance</a>    </p>
</li><li class=" ">    <p  ><a  class="document-link " href="Migrating_Node.ACS_Applications_to_API_Builder.html#src-43298928_MigratingNode.ACSApplicationstoAPIBuilder-socketSocket.ioinstance">Socket.io instance</a>    </p>
</li><li class=" ">    <p  ><a  class="document-link " href="Migrating_Node.ACS_Applications_to_API_Builder.html#src-43298928_MigratingNode.ACSApplicationstoAPIBuilder-app.js">app.js</a>    </p>
</li><li class=" ">    <p  ><a  class="document-link " href="Migrating_Node.ACS_Applications_to_API_Builder.html#src-43298928_MigratingNode.ACSApplicationstoAPIBuilder-configconfig.json">config.json</a>    </p>
<ul class="toc-indentation "><li class=" ">    <p  ><a  class="document-link " href="Migrating_Node.ACS_Applications_to_API_Builder.html#src-43298928_MigratingNode.ACSApplicationstoAPIBuilder-Routes">Routes</a>    </p>
</li><li class=" ">    <p  ><a  class="document-link " href="Migrating_Node.ACS_Applications_to_API_Builder.html#src-43298928_MigratingNode.ACSApplicationstoAPIBuilder-Filters">Filters</a>    </p>
</li><li class=" ">    <p  ><a  class="document-link " href="Migrating_Node.ACS_Applications_to_API_Builder.html#src-43298928_MigratingNode.ACSApplicationstoAPIBuilder-Websockets">Websockets</a>    </p>
</li></ul></li><li class=" ">    <p  ><a  class="document-link " href="Migrating_Node.ACS_Applications_to_API_Builder.html#src-43298928_MigratingNode.ACSApplicationstoAPIBuilder-Controllersdirectory">Controllers directory</a>    </p>
</li><li class=" ">    <p  ><a  class="document-link " href="Migrating_Node.ACS_Applications_to_API_Builder.html#src-43298928_MigratingNode.ACSApplicationstoAPIBuilder-Filtersdirectory">Filters directory</a>    </p>
</li><li class=" ">    <p  ><a  class="document-link " href="Migrating_Node.ACS_Applications_to_API_Builder.html#src-43298928_MigratingNode.ACSApplicationstoAPIBuilder-Websocketsdirectory">Websockets directory</a>    </p>
</li><li class=" ">    <p  ><a  class="document-link " href="Migrating_Node.ACS_Applications_to_API_Builder.html#src-43298928_MigratingNode.ACSApplicationstoAPIBuilder-Publicdirectory">Public directory</a>    </p>
</li><li class=" ">    <p  ><a  class="document-link " href="Migrating_Node.ACS_Applications_to_API_Builder.html#src-43298928_MigratingNode.ACSApplicationstoAPIBuilder-Viewsdirectory">Views directory</a>    </p>
</li><li class=" ">    <p  ><a  class="document-link " href="Migrating_Node.ACS_Applications_to_API_Builder.html#src-43298928_MigratingNode.ACSApplicationstoAPIBuilder-RuntheAPIBuilderproject">Run the API Builder project</a>    </p>
</li><li class=" ">    <p  ><a  class="document-link " href="Migrating_Node.ACS_Applications_to_API_Builder.html#src-43298928_MigratingNode.ACSApplicationstoAPIBuilder-PublishtheAPIBuilderproject">Publish the API Builder project</a>    </p>
</li></ul>    <div class="section section-2 " id="src-43298928_MigratingNode.ACSApplicationstoAPIBuilder-Introduction">
        <h2 class="heading "><span>Introduction</span></h2>
    <p  >This guide describes how to convert your API Runtime Services application using the MVC framework to work in the API Builder framework.    </p>
    <p  >For details about API Builder, see <a  class="document-link " href="API_Builder_Tools.html">API Builder Tools</a>.    </p>
    </div>
    <div class="section section-2 " id="src-43298928_MigratingNode.ACSApplicationstoAPIBuilder-CreateanAPIBuilderproject">
        <h2 class="heading "><span>Create an  API Builder  project</span></h2>
    <p  >Before starting, first create an API Builder project by executing the command below in your workspace directory:    </p>
    <div  class="confbox programlisting defaultnew syntaxhighlighter scroll-html-formatted-code">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain">appc </code><code class="keyword">new</code><code class="plain"> -t arrow -n ArrowProject</code></div>
</div>
    </div>
    </div>
    <div class="section section-2 " id="src-43298928_MigratingNode.ACSApplicationstoAPIBuilder-package.json">
        <h2 class="heading "><span>package.json</span></h2>
    <p  >If you have any special settings or dependencies in your API Runtime Services project's <tt class=" ">package.json</tt> file, add them to the same file in your new API Builder project. Do not overwrite any existing keys.    </p>
    </div>
    <div class="section section-2 " id="src-43298928_MigratingNode.ACSApplicationstoAPIBuilder-Expressappinstance">
        <h2 class="heading "><span>Express app instance</span></h2>
    <p  >To access the Express instance in an API Builder project, use the <tt class=" ">app</tt> property of the API Builder instance. For the API and Route components, an API Builder instance is passed to the <tt class=" ">request</tt> and <tt class=" ">response</tt> objects as the <tt class=" ">server</tt> property.    </p>
    <div  class="confbox admonition admonition-note aui-message warning shadowed information-macro">
            <div class="title">Express version</div>
            <p  >API Runtime Services used Express 3.x, while  API Builder uses Express 4.x. For details about migrating to Express 4, see <a class="external-link external-link" href="http://expressjs.com/guide/migrating-4.html">http://expressjs.com/guide/migrating-4.html</a>.    </p>
    </div>
        <p  ><strong class=" ">Example:</strong>    </p>
    <div  class="confbox programlisting defaultnew syntaxhighlighter scroll-html-formatted-code">
                    <div class="title">ArrowProject/app.js</div>
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-title="ArrowProject/app.js">
<div class="line"><code class="plain">var Arrow = require(</code><code class="string">'arrow'</code><code class="plain">),</code></div>
<div class="line"><code class="plain">    favicon = require(</code><code class="string">'serve-favicon'</code><code class="plain">),</code></div>
<div class="line"><code class="plain">    server = </code><code class="keyword">new</code><code class="plain"> Arrow();</code></div>
<div class="line"><code class="plain">server.app.use(favicon(__dirname + </code><code class="string">'/web/public/images/favicon.ico'</code><code class="plain">));</code></div>
</div>
    </div>
    </div>
    <div class="section section-2 " id="src-43298928_MigratingNode.ACSApplicationstoAPIBuilder-socketSocket.ioinstance">
        <h2 class="heading "><span id="src-43298928_MigratingNode.ACSApplicationstoAPIBuilder-socket" class="confluence-anchor-link"></span><span>Socket.io instance</span></h2>
    <p  >An API Builder application does not include socket.io by default.  To include socket.io in an  API Builder application:    </p>
<ol class=" "><li class=" ">    <p  >In the <tt class=" ">package.json</tt> file, add <tt class=" ">socket.io</tt> as a dependency.    </p>
</li><li class=" ">    <p  >In the <tt class=" ">app.js</tt>, in the <tt class=" ">started</tt> event listener, load the socket.io module and pass it the server instance (API Builder instance's <tt class=" ">server</tt> property), then make API calls to the socket.io instance.  If you assign the socket.io instance to a property of the  API Builder instance, you can access the socket.io instance with that property whenever an API Builder instance is passed to a method.    </p>
</li><li class=" ">    <p  >Any client-side code, such as the view templates, will need to <a class="external-link external-link" href="http://socket.io/download/">include the <tt class=" ">socket.io.js</tt> client script</a>. Note that when the client connects to the socket.io server (API Builder application), you will need to update the URL when switching between testing the project locally or when it's published to API Runtime Services.    </p>
</li></ol>    <p  ><strong class=" ">Example:</strong>    </p>
    <p  >The following example creates a basic chat application.    </p>
    <p  >Add socket.io as a dependency to the API Builder project.    </p>
    <div  class="confbox programlisting defaultnew syntaxhighlighter scroll-html-formatted-code">
                    <div class="title">package.json</div>
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-title="package.json">
<div class="line"><code class="plain">{</code></div>
<div class="line"><code class="plain">  ...</code></div>
<div class="line"><code class="plain">  dependencies: {</code></div>
<div class="line"><code class="plain">    ...</code></div>
<div class="line"><code class="plain">    </code><code class="string">'socket.io'</code><code class="plain">: </code><code class="string">'*'</code></div>
<div class="line"><code class="plain">  }</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
    </div>
    <p  >Loads the socket.io module and creates an instance.    </p>
    <div  class="confbox programlisting defaultnew syntaxhighlighter scroll-html-formatted-code">
                    <div class="title">app.js</div>
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-title="app.js">
<div class="line"><code class="plain">var Arrow = require(</code><code class="string">'arrow'</code><code class="plain">),</code></div>
<div class="line"><code class="plain">    server = </code><code class="keyword">new</code><code class="plain"> Arrow();</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">server.on(</code><code class="string">'started'</code><code class="plain">, function () {</code></div>
<div class="line"><code class="plain">    </code><code class="comments">// Creates a socket.io instance and attaches it to the Arrow instance</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">this</code><code class="plain">.io = require(</code><code class="string">'socket.io'</code><code class="plain">)(</code><code class="keyword">this</code><code class="plain">.server, {logger: </code><code class="keyword">this</code><code class="plain">.logger});</code></div>
<div class="line"><code class="plain">    </code><code class="comments">// Adds a connection listener </code></div>
<div class="line"><code class="plain">    </code><code class="keyword">this</code><code class="plain">.io.on(</code><code class="string">'connection'</code><code class="plain">, function(socket) {</code></div>
<div class="line"><code class="plain">        console.log(</code><code class="string">'a user connected '</code><code class="plain"> + socket.id);</code></div>
<div class="line"><code class="plain">        </code><code class="comments">// Listens for a new message</code></div>
<div class="line"><code class="plain">        socket.on(</code><code class="string">'message'</code><code class="plain">, function(data) {</code></div>
<div class="line"><code class="plain">            </code><code class="comments">// Alerts all clients there is a new message</code></div>
<div class="line"><code class="plain">            </code><code class="keyword">this</code><code class="plain">.io.emit(</code><code class="string">'message'</code><code class="plain">, data);</code></div>
<div class="line"><code class="plain">        });</code></div>
<div class="line"><code class="plain">    });</code></div>
<div class="line"><code class="plain">});</code></div>
<div class="line"> </div>
<div class="line"><code class="comments">// start the server</code></div>
<div class="line"><code class="plain">server.start(); </code></div>
</div>
    </div>
    <p  >Then, add the socket.io client code to your views or other client-side code.    </p>
    <div  class="confbox programlisting defaultnew syntaxhighlighter scroll-html-formatted-code">
                    <div class="title">web/views/chat.html</div>
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-title="web/views/chat.html">
<div class="line"><code class="plain">&lt;html&gt;</code></div>
<div class="line"><code class="plain">  &lt;head&gt;</code></div>
<div class="line"><code class="plain">    &lt;style&gt;</code></div>
<div class="line"><code class="plain">      * { margin: </code><code class="value">0</code><code class="plain">; padding: </code><code class="value">0</code><code class="plain">; box-sizing: border-box; }</code></div>
<div class="line"><code class="plain">      body { font: 13px Helvetica, Arial; }</code></div>
<div class="line"><code class="plain">      .inputMessage { padding: 3px; position: fixed; bottom: </code><code class="value">0</code><code class="plain">; width: </code><code class="value">100</code><code class="plain">%; }</code></div>
<div class="line"><code class="plain">      .messages { list-style-type: none; margin: </code><code class="value">0</code><code class="plain">; padding: </code><code class="value">0</code><code class="plain">; }</code></div>
<div class="line"><code class="plain">      .messages li { padding: 5px 10px; }</code></div>
<div class="line"><code class="plain">      .messages li:nth-child(odd) { background: #eee; }      </code></div>
<div class="line"><code class="plain">    &lt;/style&gt;</code></div>
<div class="line"><code class="plain">    &lt;script src=</code><code class="string">"http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"</code><code class="plain">&gt;&lt;/script&gt;</code></div>
<div class="line"><code class="plain">    &lt;!-- Include the socket.io client code --&gt;</code></div>
<div class="line"><code class="plain">    &lt;script src=</code><code class="string">"https://cdn.socket.io/socket.io-1.3.5.js"</code><code class="plain">&gt;&lt;/script&gt;</code></div>
<div class="line"><code class="plain">    &lt;script&gt;</code></div>
<div class="line"><code class="plain">      $(document).ready(function() {</code></div>
<div class="line"><code class="plain">        </code><code class="comments">// For a production application, you need to change the URL to the published URL</code></div>
<div class="line"><code class="plain">        var socket = io.connect(</code><code class="string">'http://localhost:8080'</code><code class="plain">);</code></div>
<div class="line"><code class="plain">        $(</code><code class="string">'.inputMessage'</code><code class="plain">).keydown(function(event) {</code></div>
<div class="line"><code class="plain">          </code><code class="keyword">if</code><code class="plain"> (event.keyCode == </code><code class="value">13</code><code class="plain">) {</code></div>
<div class="line"><code class="plain">            socket.emit(</code><code class="string">'message'</code><code class="plain">, socket.id + </code><code class="string">':'</code><code class="plain"> + $(</code><code class="string">'.inputMessage'</code><code class="plain">).val());</code></div>
<div class="line"><code class="plain">            $(</code><code class="string">'.inputMessage'</code><code class="plain">).val(</code><code class="string">''</code><code class="plain">);</code></div>
<div class="line"><code class="plain">            </code><code class="keyword">return</code><code class="plain"> </code><code class="keyword">false</code><code class="plain">;</code></div>
<div class="line"><code class="plain">          }</code></div>
<div class="line"><code class="plain">        });</code></div>
<div class="line"><code class="plain">        socket.on(</code><code class="string">'message'</code><code class="plain">, function(msg){</code></div>
<div class="line"><code class="plain">          $(</code><code class="string">'.messages'</code><code class="plain">).append($(</code><code class="string">'&lt;li&gt;'</code><code class="plain">).text(msg));</code></div>
<div class="line"><code class="plain">        });</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">        socket.on(</code><code class="string">'connect'</code><code class="plain">, function(){</code></div>
<div class="line"><code class="plain">          $(</code><code class="string">'.messages'</code><code class="plain">).append($(</code><code class="string">'&lt;li&gt;'</code><code class="plain">).text(</code><code class="string">'You are '</code><code class="plain"> + socket.id));</code></div>
<div class="line"><code class="plain">        });</code></div>
<div class="line"><code class="plain">      });</code></div>
<div class="line"><code class="plain">    &lt;/script&gt;</code></div>
<div class="line"><code class="plain">  &lt;/head&gt;</code></div>
<div class="line"><code class="plain">  &lt;body&gt;</code></div>
<div class="line"><code class="plain">    &lt;div </code><code class="keyword">class</code><code class="plain">=</code><code class="string">"chatArea"</code><code class="plain">&gt;</code></div>
<div class="line"><code class="plain">    &lt;ul </code><code class="keyword">class</code><code class="plain">=</code><code class="string">"messages"</code><code class="plain">&gt;&lt;/ul&gt;</code></div>
<div class="line"><code class="plain">    &lt;/div&gt;</code></div>
<div class="line"><code class="plain">    &lt;input </code><code class="keyword">class</code><code class="plain">=</code><code class="string">"inputMessage"</code><code class="plain"> placeholder=</code><code class="string">"Type here..."</code><code class="plain">/&gt;</code></div>
<div class="line"><code class="plain">  &lt;/body&gt;</code></div>
<div class="line"><code class="plain">&lt;/html&gt; </code></div>
</div>
    </div>
    <p  >Note you need to implement an API Builder Route to render the HTML.    </p>
    <div  class="confbox programlisting defaultnew syntaxhighlighter scroll-html-formatted-code">
                    <div class="title">web/route/chat.js</div>
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-title="web/route/chat.js">
<div class="line"><code class="plain">var Arrow = require(</code><code class="string">'arrow'</code><code class="plain">);</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">var ChatRoute = Arrow.Router.extend({</code></div>
<div class="line"><code class="plain">    name: </code><code class="string">'chat'</code><code class="plain">,</code></div>
<div class="line"><code class="plain">    path: </code><code class="string">'/chat'</code><code class="plain">,</code></div>
<div class="line"><code class="plain">    method: </code><code class="string">'GET'</code><code class="plain">,</code></div>
<div class="line"><code class="plain">    description: </code><code class="string">'Access the chat client'</code><code class="plain">,</code></div>
<div class="line"><code class="plain">    action: function (req, res) {</code></div>
<div class="line"><code class="plain">        res.render(</code><code class="string">'chat'</code><code class="plain">);</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"><code class="plain">});</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">module.exports = ChatRoute; </code></div>
</div>
    </div>
    </div>
    <div class="section section-2 " id="src-43298928_MigratingNode.ACSApplicationstoAPIBuilder-app.js">
        <h2 class="heading "><span>app.js</span></h2>
    <p  >If you add any logic to the <tt class=" ">start()</tt> or <tt class=" ">stop()</tt> methods in the <tt class=" ">app.js</tt> file, you can add the same logic in the API Builder instance's event listeners for the <tt class=" ">starting</tt> and <tt class=" ">stopping</tt> events, respectively.    </p>
    <p  ><strong class=" ">Example:</strong>    </p>
    <p  >The API Runtime Services project logs in and out of an Mobile Backend Services (MBS) account when the application starts and stops.  The same method calls can be added to the event listeners in an API Builder application.    </p>
    <div  class="confbox programlisting defaultnew syntaxhighlighter scroll-html-formatted-code">
                    <div class="title">NodeACSProject/app.js</div>
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-title="NodeACSProject/app.js">
<div class="line"><code class="plain">var ArrowDB = require(</code><code class="string">'arrowdb'</code><code class="plain">),</code></div>
<div class="line"><code class="plain">    arrowDBApp = </code><code class="keyword">new</code><code class="plain"> ArrowDB(</code><code class="string">'API_KEY'</code><code class="plain">);</code></div>
<div class="line"><code class="plain"> </code></div>
<div class="line"><code class="plain">function start() {</code></div>
<div class="line"><code class="plain">    var data = {</code></div>
<div class="line"><code class="plain">        login: </code><code class="string">'user'</code><code class="plain">,</code></div>
<div class="line"><code class="plain">        password: </code><code class="string">'user'</code></div>
<div class="line"><code class="plain">    };</code></div>
<div class="line"><code class="plain">    arrowDBApp.usersLogin(data, function(err, result) {</code></div>
<div class="line"><code class="plain">        </code><code class="comments">// Logic</code></div>
<div class="line"><code class="plain">    });  </code></div>
<div class="line"><code class="plain">}</code></div>
<div class="line"><code class="plain"> </code></div>
<div class="line"><code class="plain">function stop() {</code></div>
<div class="line"><code class="plain">    arrowDBApp.usersLogout(function(err, result) {</code></div>
<div class="line"><code class="plain">        </code><code class="comments">// Logic</code></div>
<div class="line"><code class="plain">    }); </code></div>
<div class="line"><code class="plain">}</code></div>
</div>
    </div>
    <div  class="confbox programlisting defaultnew syntaxhighlighter scroll-html-formatted-code">
                    <div class="title">ArrowProject/app.js</div>
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-title="ArrowProject/app.js">
<div class="line"><code class="plain">var Arrow = require(</code><code class="string">'arrow'</code><code class="plain">),</code></div>
<div class="line"><code class="plain">    server = </code><code class="keyword">new</code><code class="plain"> Arrow(),</code></div>
<div class="line"><code class="plain">    ArrowDB = require(</code><code class="string">'arrowdb'</code><code class="plain">),</code></div>
<div class="line"><code class="plain">    arrowDBApp = </code><code class="keyword">new</code><code class="plain"> ArrowDB(</code><code class="string">'API_KEY'</code><code class="plain">);</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">server.on(</code><code class="string">'starting'</code><code class="plain">, function () {</code></div>
<div class="line"><code class="plain">    var data = {</code></div>
<div class="line"><code class="plain">        login: </code><code class="string">'user'</code><code class="plain">,</code></div>
<div class="line"><code class="plain">        password: </code><code class="string">'user'</code></div>
<div class="line"><code class="plain">    };</code></div>
<div class="line"><code class="plain">    arrowDBApp.usersLogin(data, function(err, result) {</code></div>
<div class="line"><code class="plain">        </code><code class="comments">// Logic</code></div>
<div class="line"><code class="plain">    });  </code></div>
<div class="line"><code class="plain">}</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">server.on(</code><code class="string">'stopping'</code><code class="plain">, function () {</code></div>
<div class="line"><code class="plain">    arrowDBApp.usersLogout(function(err, result) {</code></div>
<div class="line"><code class="plain">        </code><code class="comments">// Logic</code></div>
<div class="line"><code class="plain">    }); </code></div>
<div class="line"><code class="plain">}</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">server.start();</code></div>
</div>
    </div>
    </div>
    <div class="section section-2 " id="src-43298928_MigratingNode.ACSApplicationstoAPIBuilder-configconfig.json">
        <h2 class="heading "><span>config.json</span></h2>
    <div class="section section-3 " id="src-43298928_MigratingNode.ACSApplicationstoAPIBuilder-Routes">
        <h3 class="heading "><span>Routes</span></h3>
    <p  >All routes declared in the <tt class=" ">config.json</tt> file of your API Runtime Services application may be declared as a:    </p>
<ul class=" "><li class=" ">    <p  >API Builder Route located in the <tt class=" ">web/routes</tt> folder of the API Builder project if the route renders UI. For details, see the example below and <a  class="document-link " href="API_Builder_Web.html">API Builder Web</a>.    </p>
</li><li class=" ">    <p  >API Builder Model if the route is a simple data object stored in the cloud that you want to have standardized HTTP endpoints. For details, see <a  class="document-link " href="Models.html">Models</a>.    </p>
</li><li class=" ">    <p  >API Builder API if the route performs more complex operations and you want to have a custom HTTP endpoint. For details, see <a  class="document-link " href="APIs_-_Legacy.html">APIs - Legacy</a>.    </p>
</li></ul>    <p  ><strong class=" ">Example:</strong>    </p>
    <p  >The <tt class=" ">config.json</tt> file defines a route that when someone accesses <tt class=" ">SERVER_ADDRESS/foobar</tt>, the API Runtime Services application executes the <tt class=" ">bar()</tt> method in the <tt class=" ">controllers/foo.js</tt> file.    </p>
    <div  class="confbox programlisting defaultnew syntaxhighlighter scroll-html-formatted-code">
                    <div class="title">config.json</div>
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-title="config.json">
<div class="line"><code class="plain">{</code></div>
<div class="line"><code class="plain">  </code><code class="string">"routes"</code><code class="plain">:</code></div>
<div class="line"><code class="plain">  [</code></div>
<div class="line"><code class="plain">    {</code><code class="string">"path"</code><code class="plain">: </code><code class="string">"/foobar"</code><code class="plain">, </code><code class="string">"method"</code><code class="plain">: </code><code class="string">"get"</code><code class="plain">, </code><code class="string">"callback"</code><code class="plain">: </code><code class="string">"foo#bar"</code><code class="plain">}</code></div>
<div class="line"><code class="plain">  ]</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
    </div>
    <p  >To use the same route in API Builder, create a CommonJS module, which loads the <tt class=" ">arrow</tt> module, then call the module's <tt class=" ">Router.extend()</tt> method to declare the route.  Pass a dictionary to the <tt class=" ">extend()</tt> method with the following keys defined (all keys are required):    </p>
    <div  class="tablewrap">
        <table class="confluenceTable">
        <thead class=" ">    <tr >
            <td  class="confluenceTh" rowspan="1" colspan="1">
        <p  >Key    </p>
            </td>
                <td  class="confluenceTh" rowspan="1" colspan="1">
        <p  >Description    </p>
            </td>
        </tr>
</thead><tfoot class=" "></tfoot><tbody class=" ">    <tr >
            <td  class="confluenceTd" rowspan="1" colspan="1">
        <p  >name    </p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
        <p  >The name of your route.    </p>
            </td>
        </tr>
    <tr >
            <td  class="confluenceTd" rowspan="1" colspan="1">
        <p  >path    </p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
        <p  >The endpoint/path for your route.    </p>
            </td>
        </tr>
    <tr >
            <td  class="confluenceTd" rowspan="1" colspan="1">
        <p  >method    </p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
        <p  >HTTP verb ('DELETE', 'GET', 'POST' or 'PUT').    </p>
            </td>
        </tr>
    <tr >
            <td  class="confluenceTd" rowspan="1" colspan="1">
        <p  >description    </p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
        <p  >A description for your route. This is used for documentation purposes.    </p>
            </td>
        </tr>
    <tr >
            <td  class="confluenceTd" rowspan="1" colspan="1">
        <p  >action    </p>
            </td>
                <td  class="confluenceTd" rowspan="1" colspan="1">
        <p  >Function that allows you to interact with API Builder APIs and Models and send data to your template engine.    </p>
            </td>
        </tr>
</tbody>        </table>
            </div>
    <p  >Finally, expose the route using the <tt class=" ">modules.exports</tt> variable.    </p>
    <div  class="confbox programlisting defaultnew syntaxhighlighter scroll-html-formatted-code">
                    <div class="title">web/routes/foobar.js</div>
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-title="web/routes/foobar.js">
<div class="line"><code class="plain">var Arrow = require(</code><code class="string">'arrow'</code><code class="plain">);</code></div>
<div class="line"><code class="plain">var Foobar = Arrow.Router.extend({</code></div>
<div class="line"><code class="plain">    name: </code><code class="string">'foobar'</code><code class="plain">,</code></div>
<div class="line"><code class="plain">    path: </code><code class="string">'/foobar'</code><code class="plain">,</code></div>
<div class="line"><code class="plain">    method: </code><code class="string">'GET'</code><code class="plain">,</code></div>
<div class="line"><code class="plain">    description: </code><code class="string">'Does foo'</code><code class="plain">,</code></div>
<div class="line"><code class="plain">    action: function (req, res) {</code></div>
<div class="line"><code class="plain">        res.render(</code><code class="string">'example'</code><code class="plain">);</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"><code class="plain">});</code></div>
<div class="line"><code class="plain">module.exports = Foobar;</code></div>
</div>
    </div>
    </div>
    <div class="section section-3 " id="src-43298928_MigratingNode.ACSApplicationstoAPIBuilder-Filters">
        <h3 class="heading "><span>Filters</span></h3>
    <p  >All filters declared in the <tt class=" ">config.json</tt> file of your API Runtime Services application may be declared as an <a  class="document-link " href="API_Builder_Blocks_-_Legacy.html">API Builder Blocks</a> that can be assigned to the <tt class=" ">before</tt> property in the definition file of an  API Builder Model or API.    </p>
    </div>
    <div class="section section-3 " id="src-43298928_MigratingNode.ACSApplicationstoAPIBuilder-Websockets">
        <h3 class="heading "><span>Websockets</span></h3>
    <p  >For all websockets declared in the <tt class=" ">config.json</tt> file of your API Runtime Services application, you will need to add an event listener to the socket once a connection is established, which requires socket.io to be added to the project. For details, see the <a  class="document-link " href="Migrating_Node.ACS_Applications_to_API_Builder.html#src-43298928_MigratingNode.ACSApplicationstoAPIBuilder-socket">socket.io instance</a> section above.    </p>
    <p  ><strong class=" ">Example:</strong>    </p>
    <p  >The <tt class=" ">config.json</tt> file defines a websocket that whenever a <tt class=" ">newChatMsg</tt> is received, the API Runtime Services application executes the <tt class=" ">receiveMessage()</tt> method in the <tt class=" ">websockets/chatroom.js</tt> file.    </p>
    <div  class="confbox programlisting defaultnew syntaxhighlighter scroll-html-formatted-code">
                    <div class="title">NodeACSProject/config.json</div>
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-title="NodeACSProject/config.json">
<div class="line"><code class="plain">{</code></div>
<div class="line"><code class="plain">  </code><code class="string">"websockets"</code><code class="plain">:  [</code></div>
<div class="line"><code class="plain">    {</code><code class="string">"event"</code><code class="plain">: </code><code class="string">"newChatMsg"</code><code class="plain">, </code><code class="string">"callback"</code><code class="plain">: </code><code class="string">"chatroom#receiveMessage"</code><code class="plain">}</code></div>
<div class="line"><code class="plain">  ]</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
    </div>
    <p  >To use the same websocket in API Builder, first add socket.io as described in the <a  class="document-link " href="Migrating_Node.ACS_Applications_to_API_Builder.html#src-43298928_MigratingNode.ACSApplicationstoAPIBuilder-socket"> socket.io instance </a>  section, then add a <tt class=" ">newChatMsg</tt> event listener for the socket in the <tt class=" ">connection</tt> event listener.    </p>
    <div  class="confbox programlisting defaultnew syntaxhighlighter scroll-html-formatted-code">
                    <div class="title">ArrowProject/app.js</div>
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-title="ArrowProject/app.js">
<div class="line"><code class="plain"> var Arrow = require(</code><code class="string">'arrow'</code><code class="plain">),</code></div>
<div class="line"><code class="plain">    server = </code><code class="keyword">new</code><code class="plain"> Arrow();</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">server.on(</code><code class="string">'started'</code><code class="plain">, function () {</code></div>
<div class="line"><code class="plain">    </code><code class="comments">// Creates a socket.io instance and attaches it to the Arrow instance</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">this</code><code class="plain">.io = require(</code><code class="string">'socket.io'</code><code class="plain">)(</code><code class="keyword">this</code><code class="plain">.server, {logger: </code><code class="keyword">this</code><code class="plain">.logger});</code></div>
<div class="line"><code class="plain">    </code><code class="comments">// Adds a connection listener </code></div>
<div class="line"><code class="plain">    </code><code class="keyword">this</code><code class="plain">.io.on(</code><code class="string">'connection'</code><code class="plain">, function(socket) {</code></div>
<div class="line"><code class="plain">        socket.on(</code><code class="string">'newChatMsg'</code><code class="plain">, function(data) {</code></div>
<div class="line"><code class="plain">            </code><code class="comments">// Add the receiveMessage() logic here from websockets/chatroom.js</code></div>
<div class="line"><code class="plain">        });</code></div>
<div class="line"><code class="plain">    });</code></div>
<div class="line"><code class="plain">});</code></div>
<div class="line"> </div>
<div class="line"><code class="comments">// start the server</code></div>
<div class="line"><code class="plain">server.start(); </code></div>
</div>
    </div>
    </div>
    </div>
    <div class="section section-2 " id="src-43298928_MigratingNode.ACSApplicationstoAPIBuilder-Controllersdirectory">
        <h2 class="heading "><span>Controllers directory</span></h2>
    <p  >All logic declared in the API Runtime Services controllers should be moved to the API Builder Route module in the <tt class=" ">web/routes</tt> folder of the API Builder project or API Builder API module. For details, see the   <a  class="document-link " href="Migrating_Node.ACS_Applications_to_API_Builder.html#src-43298928_MigratingNode.ACSApplicationstoAPIBuilder-config">config.json</a>    section above.    </p>
    </div>
    <div class="section section-2 " id="src-43298928_MigratingNode.ACSApplicationstoAPIBuilder-Filtersdirectory">
        <h2 class="heading "><span>Filters directory</span></h2>
    <p  >All logic declared in the API Runtime Services filters should be moved to the API Builder Block module.    </p>
    </div>
    <div class="section section-2 " id="src-43298928_MigratingNode.ACSApplicationstoAPIBuilder-Websocketsdirectory">
        <h2 class="heading "><span>Websockets directory</span></h2>
    <p  >All logic declared in API Runtime Services websockets will need to be declared with the socket event listener, which requires socket.io to be added to the project. For details, see the   <a  class="document-link " href="Migrating_Node.ACS_Applications_to_API_Builder.html#src-43298928_MigratingNode.ACSApplicationstoAPIBuilder-config">config.json</a>  section above.    </p>
    </div>
    <div class="section section-2 " id="src-43298928_MigratingNode.ACSApplicationstoAPIBuilder-Publicdirectory">
        <h2 class="heading "><span>Public directory</span></h2>
    <p  >Copy all files in the <tt class=" ">public</tt> folder of your API Runtime Services application to the <tt class=" ">web/public</tt> folder in the new API Builder project.    </p>
    </div>
    <div class="section section-2 " id="src-43298928_MigratingNode.ACSApplicationstoAPIBuilder-Viewsdirectory">
        <h2 class="heading "><span>Views directory</span></h2>
    <p  >Copy all files in the <tt class=" ">views</tt> folder of your API Runtime Services application to the <tt class=" ">web/views</tt> folder in the new API Builder project.    </p>
    <div  class="confbox admonition admonition-note aui-message warning shadowed information-macro">
            <p  >API Builder also supports other template engines including Handlebars, Markdown and ReactJS.    </p>
    </div>
        </div>
    <div class="section section-2 " id="src-43298928_MigratingNode.ACSApplicationstoAPIBuilder-RuntheAPIBuilderproject">
        <h2 class="heading "><span>Run the  API Builder  project</span></h2>
    <p  >After you have made your changes, to test the project, run or publish the API Builder project.    </p>
    <p  >To run the API Builder project locally, execute the following command from the project's directory:    </p>
    <div  class="confbox programlisting defaultnew syntaxhighlighter scroll-html-formatted-code">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain">appc run</code></div>
</div>
    </div>
    </div>
    <div class="section section-2 " id="src-43298928_MigratingNode.ACSApplicationstoAPIBuilder-PublishtheAPIBuilderproject">
        <h2 class="heading "><span>Publish the  API Builder  project</span></h2>
    <p  >To publish the API Builder project to the cloud, execute the following command from the project's directory:    </p>
    <div  class="confbox programlisting defaultnew syntaxhighlighter scroll-html-formatted-code">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code">
<div class="line"><code class="plain">appc publish</code></div>
</div>
    </div>
    <p  >This will produce a new URL, different from that of your existing API Runtime Services project. For migrating ACS data (legacy) to Mobile Backend Services, we will take care of migrating your ACS data to the platform in time and notify you when we do. Your ACS keys and endpoints will not change, so no changes are needed to (Titanium) client applications. During the migration, we expect 1-2 hours of downtime. After the migration, you can manage your ACS data via the platform dashboard.    </p>
    </div>
        </div>
    
        <div class="footer">
            Created with <a href="http://k15t.com/display/web/Scroll-Wiki-EclipseHelp-Exporter-for-Confluence">Scroll EclipseHelp Exporter for Confluence</a>.
        </div>
    </div>
</body>
</html>
