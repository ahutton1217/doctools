<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>The source code</title>
  <link href="../resources/prettify/prettify.css" type="text/css" rel="stylesheet" />
  <script type="text/javascript" src="../resources/prettify/prettify.js"></script>
  <style type="text/css">
    .highlight { display: block; background-color: #ddd; }
  </style>
  <script type="text/javascript">
    function highlight() {
      document.getElementById(location.hash.replace(/#/, "")).className = "highlight";
    }
  </script>
</head>
<body onload="prettyPrint(); highlight();">
  <pre class="prettyprint lang-js">// jscs:disable
<span id='MarkdownRendererEngine'>/**
</span> * @class MarkdownRendererEngine
 * Renderer engine for Markdown templates.
 * @extends ArrowRendererEngine
 * @pseudo
 */

<span id='MarkdownRendererEngine-property-skipread'>/**
</span> * @property skipread
 * @hide
 */
// jscs:enable
var marked = require(&#39;appc-marked&#39;),
	fs = require(&#39;fs&#39;),
	renderer = new marked.Renderer(),
	highlight = require(&#39;highlight.js&#39;),
	util = require(&#39;./util&#39;),
	langJS = /^(javascript|js|node|node\.js|nodejs|node\-js|js|web|titanium|ti)$/i,
	looksLikeJS = /(var|function|require|undefined|typeof)/,
	options = {
		renderer: renderer,
		gfm: true,
		tables: true,
		breaks: false,
		pedantic: false,
		sanitize: true,
		smartLists: true,
		smartypants: false
	};

// jscs:disable jsDoc

exports.extension = &#39;md&#39;;
<span id='MarkdownRendererEngine-property-marked'>/**
</span> * @property {Object} marked
 * marked module instance to access its APIs.
 */
exports.marked = marked;
<span id='MarkdownRendererEngine-property-renderer'>/**
</span> * @property {Object} renderer
 * renderer module instance to access its APIs.
 */
exports.renderer = renderer;

// special code handler that does highlight.js automatically
renderer.code = function (value, lang) {
	if (!lang) {
		if (looksLikeJS.test(value)) {
			// if it sort of loosely looks like JS code, let&#39;s be a little more lenient and pass it in
			// since devs will often forget to use the language on ```
			lang = &#39;javascript&#39;;
		} else {
			return &#39;&lt;blockquote class=&quot;unformat&quot;&gt;\n&#39; + marked(value) + &#39;\n&lt;/blockquote&gt;&#39;;
		}
	}
	lang = lang &amp;&amp; lang.replace(/\./g, &#39;-&#39;);
	var html = &#39;&lt;pre class=&quot;highlight &#39; + lang + &#39; code&quot;&gt;&lt;code&gt;&#39;,
		result;
	if (langJS.test(lang)) {
		result = highlight.highlight(&#39;javascript&#39;, value).value;
	}  else if (lang &amp;&amp; highlight.getLanguage(lang)) {
		// see if we can look up the language by the name
		// and if found, don&#39;t auto-detect since it&#39;s too slow
		result = highlight.highlight(lang, value).value;
	} else {
		// worse case, we can fall back to auto detection
		result = highlight.highlightAuto(value).value;
	}
	html += result;
	html += &#39;&lt;/code&gt;&lt;/pre&gt;&#39;;
	return html;
};

function makeAnchor(text) {
	return text.toLowerCase().replace(/[^\w]+/g, &#39;-&#39;);
}

renderer.heading = function (text, level) {
	var escapedText = makeAnchor(text);
	return &#39;&lt;h&#39; + level + &#39; id=&quot;heading-&#39; + escapedText + &#39;&quot;&gt;&lt;a name=&quot;heading-&#39; + escapedText + &#39;&quot;&gt;&#39; + text + &#39;&lt;/a&gt;&lt;/h&#39; + level + &#39;&gt;&#39;;
};

function render(app, filename, opts) {
	filename = util.resolveLayoutFilename(app, filename);
	return marked(fs.readFileSync(filename).toString(), options);
}

exports.createRenderer = function (content, filename, app) {
	var tpl = marked(content, options);
	return function (filePath, opts, callback) {
		util.render(app, tpl, opts, exports.extension, render, callback);
	};
};
</pre>
</body>
</html>
